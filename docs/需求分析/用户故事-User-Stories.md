# 用户故事与验收标准
# 学生会值班管理系统

| 文档信息 | |
|----------|----------|
| 版本号 | v1.0 |
| 创建日期 | 2026-01-28 |
| 关联PRD | PRD-值班管理系统.md |

---

## Epic 1: 用户管理

### US-1.1 用户注册

**作为** 一名学生会成员  
**我希望** 能够注册系统账号  
**以便于** 参与值班管理流程

**验收标准 (Acceptance Criteria)**：
- [ ] AC1: 用户需通过邀请链接或管理员批量导入方式注册（不支持自助注册）
- [ ] AC2: 邀请链接注册时需填写：姓名、学号、邮箱、密码、所属部门
- [ ] AC3: 密码需满足最低安全要求（8位以上，包含字母和数字）
- [ ] AC4: 邮箱格式验证
- [ ] AC5: 学号不可重复注册
- [ ] AC6: 注册成功后跳转登录页
- [ ] AC7: 邀请链接有效期7天，使用后失效

---

### US-1.2 用户登录

**作为** 一名已注册用户  
**我希望** 能够登录系统  
**以便于** 使用系统功能

**验收标准**：
- [ ] AC1: 用户可以通过学号+密码登录
- [ ] AC2: 登录失败显示明确错误提示
- [ ] AC3: 支持"记住我"功能（7天免登录）
- [ ] AC4: 登录成功后根据角色跳转到对应首页

---

### US-1.3 角色权限管理

**作为** 排班管理员  
**我希望** 能够为用户分配角色  
**以便于** 控制不同用户的功能权限

**验收标准**：
- [ ] AC1: 支持三种角色：排班管理员、部门负责人、值班成员
- [ ] AC2: 管理员可以修改任意用户的角色
- [ ] AC3: 部门负责人只能查看本部门成员
- [ ] AC4: 角色变更立即生效

---

### US-1.4 部门管理

**作为** 排班管理员  
**我希望** 能够管理部门信息  
**以便于** 支持学生会换届

**验收标准**：
- [ ] AC1: 可以新增部门（名称、描述）
- [ ] AC2: 可以编辑部门信息
- [ ] AC3: 可以删除部门（需确认，且部门下无成员）
- [ ] AC4: 删除有成员的部门时提示"请先转移成员"

---

### US-1.5 值班人员勾选

**作为** 部门负责人  
**我希望** 能够勾选本部门需要参与值班的成员  
**以便于** 确定值班人员范围

**验收标准**：
- [ ] AC1: 显示本部门所有成员列表
- [ ] AC2: 可以勾选/取消勾选成员的"需要值班"状态
- [ ] AC3: 保存后系统记录哪些人需要参与排班
- [ ] AC4: 排班时仅对"需要值班"的成员进行排班

---

## Epic 2: 时间收集

### US-2.1 OA账号课表导入 ⚠️ V1延期

> **V1版本不实现**：OA课表导入功能延期至V2版本，V1仅支持ICS导入。

**作为** 值班成员  
**我希望** 能够通过学校OA账号自动导入课表  
**以便于** 快速准确地提交课表信息

**验收标准**：
- [ ] AC1: 提供OA账号和密码输入框
- [ ] AC2: 点击"导入"后调用课表解析API获取课表
- [ ] AC3: 导入成功后在日历上显示课表时间（标记为"有课"）
- [ ] AC4: 导入失败显示错误提示（如账号密码错误）
- [ ] AC5: OA密码不在系统中持久化存储

---

### US-2.2 ICS文件上传

**作为** 值班成员  
**我希望** 能够上传ICS日历文件导入课表  
**以便于** 在OA方式不可用时仍能提交课表

**验收标准**：
- [ ] AC1: 支持.ics文件上传
- [ ] AC1.1: 支持通过ICS链接导入（支持 https://、http://、webcal://）
- [ ] AC2: 解析ICS文件中的事件并显示在日历上
- [ ] AC3: 上传成功显示"导入成功，共导入X条课表记录"
- [ ] AC4: 文件格式错误时显示明确提示
- [ ] AC4.1: 链接不可访问/超时/内容非ICS时显示明确提示

---

### US-2.3 日历标记不可用时间

**作为** 值班成员  
**我希望** 能够在日历上标记除课表外的其他不可用时间  
**以便于** 告知系统我的社团、体协等活动时间

**验收标准**：
- [ ] AC1: 提供周视图和月视图切换
- [ ] AC2: 可以拖拽选择时间段
- [ ] AC3: 选择后弹出表单填写：
  - 时间段（自动填充拖拽选择的时间）
  - 原因（可选）
  - 是否重复（单次/每周重复）
- [ ] AC4: 已标记的时间在日历上以特殊颜色显示
- [ ] AC5: 可以点击已标记的时间进行编辑或删除
- [ ] AC6: 支持批量设置（如每周三19:00-21:00）

---

### US-2.4 查看时间表提交状态（部门负责人）

**作为** 部门负责人  
**我希望** 能够查看本部门成员的时间表提交状态  
**以便于** 提醒未提交的成员尽快提交

**验收标准**：
- [ ] AC1: 显示本部门所有需值班成员列表
- [ ] AC2: 每个成员显示提交状态：未提交/已提交
- [ ] AC3: 已提交的成员显示提交时间
- [ ] AC4: 可以按提交状态筛选

---

### US-2.5 查看全局提交进度（管理员）

**作为** 排班管理员  
**我希望** 能够查看所有部门的时间表提交进度  
**以便于** 判断是否可以开始排班

**验收标准**：
- [ ] AC1: 按部门分组显示提交进度
- [ ] AC2: 每个部门显示：已提交人数/应提交人数
- [ ] AC3: 显示总体进度百分比
- [ ] AC4: 点击部门可展开查看详细成员列表
- [ ] AC5: 总体进度=100%前，"开始排班"入口置灰并提示未提交名单

---

## Epic 3: 自动排班

### US-3.1 排班规则配置

**作为** 排班管理员  
**我希望** 能够配置排班规则的启用/禁用状态  
**以便于** 根据实际情况灵活调整约束条件

**验收标准**：
- [ ] AC1: 显示所有排班规则列表
- [ ] AC2: 每条规则有开关控制启用/禁用
- [ ] AC3: 规则包括：
  - 同日部门不重复
  - 相邻班次部门不重复
  - 单双周早八不重复
- [ ] AC4: 课表冲突和不可用时间冲突不可禁用（始终生效）
- [ ] AC5: 配置保存后对下次排班生效

---

### US-3.2 执行自动排班

**作为** 排班管理员  
**我希望** 能够一键执行自动排班  
**以便于** 快速生成符合规则的排班表

**验收标准**：
- [ ] AC1: 仅当时间表提交率=100%时，"开始排班"按钮可点击
- [ ] AC1.1: 提交率<100%时，提示未提交成员名单（按部门分组）
- [ ] AC2: 排班过程中显示进度提示
- [ ] AC3: 排班成功后显示排班结果预览（日历视图）
- [ ] AC4: 排班结果显示每个时段的值班人员姓名和部门
- [ ] AC5: 排班算法满足：
  - 所有启用的硬约束规则
  - 同一成员同一天最多一个班次
  - 值班次数尽量均衡
  - 上学期值过班的人优先级降低

---

### US-3.3 人力不足提示

**作为** 排班管理员  
**我希望** 在人力不足无法完成排班时收到明确提示  
**以便于** 采取相应措施

**验收标准**：
- [ ] AC1: 当无法生成满足所有约束的排班时，显示提示
- [ ] AC2: 提示信息包含：
  - 哪些时段无法安排人员
  - 建议措施（调整规则/增加人员）
- [ ] AC3: 提供"查看详情"了解具体冲突原因

---

### US-3.4 手动调整排班

**作为** 排班管理员  
**我希望** 能够手动调整自动生成的排班结果  
**以便于** 处理特殊情况

**验收标准**：
- [ ] AC1: 在日历视图中点击某个时段可以修改值班人员
- [ ] AC2: 选择新的值班人员时，实时检查是否违反规则
- [ ] AC3: 如果违反规则，显示具体违反了哪条规则
- [ ] AC4: 违反规则时不允许保存
- [ ] AC5: 调整成功后更新排班表显示
- [ ] AC6: 候选人员仅包含当前排班范围内成员（需要值班且已提交时间表）
- [ ] AC7: 若排班范围发生变更，提示"需要重新排班"并引导管理员重新排班

---

### US-3.5 发布排班表

**作为** 排班管理员  
**我希望** 能够发布最终的排班表  
**以便于** 通知所有成员查看自己的值班安排

**验收标准**：
- [ ] AC1: 点击"发布"按钮确认发布
- [ ] AC2: 发布前显示确认对话框
- [ ] AC3: 发布后排班表状态变为"已发布"
- [ ] AC4: 发布后自动发送邮件通知所有值班成员
- [ ] AC5: 邮件内容包含该成员本学期的所有值班时段

---

## Epic 4: 换班管理

### US-4.1 申请换班

**作为** 值班成员  
**我希望** 能够申请换班  
**以便于** 在有特殊情况时调整我的值班时间

**验收标准**：
- [ ] AC1: 在我的排班列表中点击某个班次可以发起换班申请
- [ ] AC2: 选择想要换班的目标成员（仅显示：在排班范围内、对该班次无课表/不可用冲突且当日无其他班次的成员）
- [ ] AC3: 填写换班原因（可选）
- [ ] AC4: 超过截止时间的班次不显示换班按钮
- [ ] AC5: 提交后状态变为"等待对方同意"
- [ ] AC6: 若目标成员时间冲突或当日已有其他班次，提交时提示原因并阻止提交
- [ ] AC7: 若目标成员不在排班范围内，提交时提示原因并阻止提交

---

### US-4.2 同意/拒绝换班

**作为** 被请求换班的值班成员  
**我希望** 能够同意或拒绝换班请求  
**以便于** 确认我是否能够接受这个班次

**验收标准**：
- [ ] AC1: 收到换班请求后在系统中显示待处理消息
- [ ] AC2: 可以查看换班详情（谁发起、哪个班次、原因）
- [ ] AC3: 可以选择"同意"或"拒绝"
- [ ] AC4: 同意后状态变为"等待管理员审核"
- [ ] AC5: 拒绝后通知申请人

---

### US-4.3 管理员审核换班

**作为** 排班管理员  
**我希望** 能够审核换班申请  
**以便于** 最终确认换班是否生效

**验收标准**：
- [ ] AC1: 显示所有待审核的换班申请列表
- [ ] AC2: 可以查看换班详情
- [ ] AC3: 可以选择"批准"或"驳回"
- [ ] AC4: 批准后排班表自动更新
- [ ] AC5: 双方成员收到邮件通知结果

---

## Epic 5: 签到签退

### US-5.1 值班签到

**作为** 值班成员  
**我希望** 能够在值班时签到  
**以便于** 记录我的出勤情况

**验收标准**：
- [ ] AC1: 值班开始前15分钟，签到按钮变为可用
- [ ] AC2: 点击签到记录当前时间
- [ ] AC3: 签到成功显示"签到成功"提示
- [ ] AC4: 重复点击签到无效（已签到状态）
- [ ] AC5: 超过值班开始时间签到，标记为"迟到"

---

### US-5.2 值班签退

**作为** 值班成员  
**我希望** 能够在值班结束时签退  
**以便于** 完成本次值班记录

**验收标准**：
- [ ] AC1: 值班结束前15分钟，签退按钮变为可用
- [ ] AC2: 点击签退记录当前时间
- [ ] AC3: 签退成功显示"签退成功，本次值班完成"
- [ ] AC4: 必须先签到才能签退
- [ ] AC5: 超过值班结束后15分钟未签退，标记为"未签退"
- [ ] AC6: 标记为"未签退"后自动通知管理员

---

### US-5.3 缺席自动标记

**作为** 系统  
**我希望** 能够自动标记缺席人员  
**以便于** 管理员了解出勤异常情况

**验收标准**：
- [ ] AC1: 值班开始后15分钟仍未签到，自动标记为"缺席"
- [ ] AC2: 缺席记录保存到数据库
- [ ] AC3: 自动发送邮件通知管理员
- [ ] AC4: 邮件包含：缺席人员姓名、班次时间、部门

---

### US-5.4 缺席后补签

**作为** 值班成员  
**我希望** 在被标记缺席后仍可补签  
**以便于** 让管理员看到我实际到场情况

**验收标准**：
- [ ] AC1: 被标记为"缺席"后仍可进行签到操作
- [ ] AC2: 补签后状态变为"缺席（已补签）"并保留补签时间
- [ ] AC3: 补签后自动通知管理员

---

## Epic 6: 通知提醒

### US-6.1 值班提醒

**作为** 值班成员  
**我希望** 在值班前1天收到邮件提醒  
**以便于** 不会忘记值班

**验收标准**：
- [ ] AC1: 系统每天定时检查次日的值班安排
- [ ] AC2: 向有值班的成员发送提醒邮件
- [ ] AC3: 邮件包含：值班日期、时间段、地点
- [ ] AC4: 邮件发送时间可配置（默认：值班前1天的09:00）

---

## Epic 8: 导出

### US-8.1 导出排班表 [P1]

**作为** 排班管理员  
**我希望** 导出本学期排班表  
**以便于** 线下备份或对外提交

**验收标准**：
- [ ] AC1: 支持按学期导出排班表
- [ ] AC2: 导出内容包含：日期/星期/时间段/值班人员/部门/地点
- [ ] AC3: 支持CSV或Excel格式

---

### US-8.2 导出签到统计 [P1]

**作为** 排班管理员  
**我希望** 导出本学期签到统计  
**以便于** 汇总出勤情况

**验收标准**：
- [ ] AC1: 支持按学期导出签到统计
- [ ] AC2: 导出内容包含：成员/部门/班次时间/签到时间/签退时间/状态
- [ ] AC3: 支持CSV或Excel格式

---

### US-6.2 排班发布通知

**作为** 值班成员  
**我希望** 在排班表发布后收到通知  
**以便于** 第一时间查看我的值班安排

**验收标准**：
- [ ] AC1: 排班表发布后立即发送邮件
- [ ] AC2: 邮件包含该成员本学期所有值班班次列表
- [ ] AC3: 邮件提供系统链接可以查看完整排班表

---

### US-6.3 换班结果通知

**作为** 换班申请相关方  
**我希望** 在换班流程各阶段收到通知  
**以便于** 了解换班进度

**验收标准**：
- [ ] AC1: 换班申请提交后，目标成员收到邮件
- [ ] AC2: 目标成员同意/拒绝后，申请人收到邮件
- [ ] AC3: 管理员审核后，双方都收到邮件
- [ ] AC4: 邮件包含换班详情和最终结果

---

## Epic 7: 系统配置

### US-7.1 学期管理

**作为** 排班管理员  
**我希望** 能够配置学期信息  
**以便于** 系统正确识别排班周期

**验收标准**：
- [ ] AC1: 可以新增学期（名称、开始日期、结束日期）
- [ ] AC2: 可以设置学期的第一周是单周还是双周
- [ ] AC3: 可以设置当前活动学期
- [ ] AC4: 排班和值班都基于当前活动学期

---

### US-7.2 时间段配置

**作为** 排班管理员  
**我希望** 能够配置每日的值班时间段  
**以便于** 灵活调整值班安排

**验收标准**：
- [ ] AC1: 可以增删改时间段（开始时间、结束时间）
- [ ] AC2: 可以分别配置周一~周四和周五的时间段
- [ ] AC3: 时间段不能重叠
- [ ] AC4: 修改时间段后，新的排班按新配置执行

---

### US-7.3 换班截止时间配置

**作为** 排班管理员  
**我希望** 能够配置换班申请的截止时间  
**以便于** 控制换班申请的时效性

**验收标准**：
- [ ] AC1: 可以设置换班截止时间（如值班前24小时）
- [ ] AC2: 超过截止时间的班次不允许发起换班申请
- [ ] AC3: 配置修改后立即生效

---

## 用户故事地图总览

```
┌────────────────────────────────────────────────────────────────────────────────────┐
│                                    用户故事地图                                      │
├────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                    │
│   用户管理          时间收集          自动排班          换班管理          签到签退    │
│   ────────          ────────          ────────          ────────          ────────  │
│   │                 │                 │                 │                 │        │
│   ├─ 注册 [P0]      ├─ ICS上传 [P0]   ├─ 规则配置 [P0]  ├─ 申请换班 [P0]  ├─ 签到    │
│   │                 │                 │                 │                 │  [P0]  │
│   ├─ 登录 [P0]      ├─ 日历标记 [P0]  ├─ 自动排班 [P0]  ├─ 同意换班 [P0]  │        │
│   │                 │                 │                 │                 ├─ 签退  │
│   ├─ 角色管理 [P0]  ├─ 日历标记 [P0]  ├─ 人力不足 [P0]  ├─ 审核换班 [P0]  │  [P0]  │
│   │                 │                 │                 │                 │        │
│   ├─ 部门管理 [P0]  ├─ 提交状态 [P0]  ├─ 手动调整 [P0]  │                 ├─ 缺席  │
│   │                 │                 │                 │                 │  [P0]  │
│   └─ 人员勾选 [P0]  └─ 全局进度 [P0]  └─ 发布 [P0]      │                 │        │
│                                                                                    │
│                                                                                    │
│   通知提醒          系统配置                                                        │
│   ────────          ────────                                                        │
│   │                 │                                                              │
│   ├─ 值班提醒 [P0]  ├─ 学期管理 [P0]                                               │
│   │                 │                                                              │
│   ├─ 发布通知 [P0]  ├─ 时间段配置 [P0]                                             │
│   │                 │                                                              │
│   └─ 换班通知 [P0]  └─ 截止时间 [P0]                                               │
│                                                                                    │
└────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 版本历史

| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|----------|--------|
| v1.0 | 2026-01-28 | 初稿 | - |
