# 产品需求文档 (PRD)
# 学生会值班管理系统

| 文档信息 | |
|----------|----------|
| 版本号 | v1.0 |
| 创建日期 | 2026-01-28 |
| 最后更新 | 2026-01-28 |
| 文档状态 | 草稿 |

---

## 一、项目背景

### 1.1 项目概述

本项目旨在为学校学生会开发一套**值班管理系统**，解决当前人工排班效率低下、规则约束无法保证、跨学期数据难以统计等问题。

### 1.2 现状分析

**当前流程**：
1. 收集学生课表（PDF格式）→ 人工录入Excel
2. 收集学生其他不可用时间（体协、社团活动等）
3. 秘书部成员人工排班
4. 通过微信群/Excel发布排班表

**核心痛点**：

| 问题 | 影响 |
|------|------|
| 人工录入课表易出错 | 给有课的同学排班，造成冲突 |
| 无法保证排班规则 | 同一部门多人同天值班、早八重复等 |
| 人工排班耗时长 | 每学期需要数天完成排班 |
| 跨学期数据缺失 | 无法统计历史值班情况 |
| 换班管理混乱 | 微信沟通，无记录追溯 |

### 1.3 项目目标

| 目标 | 描述 | 成功指标 |
|------|------|----------|
| **自动化排班** | 系统自动生成符合规则的排班表 | 排班时间从数天缩短至10分钟内 |
| **规则约束保障** | 100%满足硬约束规则 | 零规则冲突 |
| **时间冲突检测** | 自动检测课表及其他时间冲突 | 零时间冲突 |
| **换班流程规范化** | 在线申请、审批、记录 | 换班全流程可追溯 |
| **数据可追溯** | 记录历史值班数据 | 支持跨学期查询 |

---

## 二、用户画像与使用场景

### 2.1 用户角色

#### 角色1：排班管理员（秘书部）

| 属性 | 描述 |
|------|------|
| 人数 | 5-15人（共用1个管理员账号） |
| 身份 | 秘书部成员 |
| 技术水平 | 中等，熟悉基本办公软件 |
| 核心诉求 | 快速完成排班、减少重复劳动、规则自动检查 |
| 使用频率 | 集中在学期初排班期间，日常处理换班申请 |

**核心场景**：
- 配置学期信息、排班规则
- 查看各部门时间表提交进度
- 执行自动排班
- 手动微调排班结果
- 审核换班申请
- 处理缺席通知

#### 角色2：部门负责人（部长/副部长）

| 属性 | 描述 |
|------|------|
| 人数 | 约26人（13个部门 × 2） |
| 身份 | 各部门部长、副部长 |
| 核心诉求 | 管理本部门值班人员名单、确认成员提交状态 |
| 使用频率 | 学期初集中使用 |

**核心场景**：
- 勾选本部门需要参与值班的成员
- 查看本部门成员时间表提交状态
- 提醒未提交的成员

#### 角色3：值班成员

| 属性 | 描述 |
|------|------|
| 人数 | 100-150人 |
| 身份 | 大一成员、大二新招成员 |
| 技术水平 | 较高，熟悉手机/电脑操作 |
| 核心诉求 | 便捷提交时间、查看排班、换班方便 |
| 使用频率 | 学期初提交时间表，日常查看排班和签到 |

**核心场景**：
- 导入课表（OA自动拉取或ICS上传）
- 在日历上标记其他不可用时间
- 查看个人排班表
- 申请换班
- 值班签到/签退

### 2.2 用户旅程

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              学期初排班流程                                        │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  [管理员]              [部门负责人]           [值班成员]                           │
│     │                      │                     │                              │
│     │ 1.配置学期信息        │                     │                              │
│     │ 2.配置排班规则        │                     │                              │
│     │ 3.开放时间收集        │                     │                              │
│     │─────────────────────>│                     │                              │
│     │                      │ 4.勾选值班人员       │                              │
│     │                      │────────────────────>│                              │
│     │                      │                     │ 5.导入课表                    │
│     │                      │                     │ 6.标记不可用时间               │
│     │                      │<────────────────────│                              │
│     │                      │ 7.确认提交状态       │                              │
│     │<─────────────────────│                     │                              │
│     │ 8.查看提交进度        │                     │                              │
│     │ 9.执行自动排班        │                     │                              │
│     │ 10.手动微调          │                     │                              │
│     │ 11.发布排班表        │                     │                              │
│     │─────────────────────────────────────────>│                              │
│     │                      │                     │ 12.收到邮件通知               │
│     │                      │                     │ 13.查看排班表                 │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              日常值班流程                                         │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  [值班成员A]            [值班成员B]            [管理员]                           │
│     │                      │                     │                              │
│     │ 1.收到值班提醒(前1天) │                     │                              │
│     │ 2.到达值班地点        │                     │                              │
│     │ 3.签到(前15分钟可签)  │                     │                              │
│     │ 4.值班中...          │                     │                              │
│     │ 5.签退(后15分钟内)    │                     │                              │
│     │                      │                     │                              │
│     │ ──────── 若需要换班 ────────                │                              │
│     │                      │                     │                              │
│     │ 6.发起换班申请        │                     │                              │
│     │─────────────────────>│                     │                              │
│     │                      │ 7.同意换班          │                              │
│     │                      │────────────────────>│                              │
│     │                      │                     │ 8.审核通过                   │
│     │<─────────────────────────────────────────│                              │
│     │ 9.收到换班成功通知    │                     │                              │
│     │                      │<────────────────────│                              │
│     │                      │ 10.收到换班成功通知  │                              │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 三、功能需求

### 3.1 功能模块总览

```
┌─────────────────────────────────────────────────────────────────┐
│                     学生会值班管理系统                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   用户管理    │  │   时间收集    │  │   自动排班    │          │
│  ├──────────────┤  ├──────────────┤  ├──────────────┤          │
│  │ • 登录注册    │  │ • 课表导入(ICS)│  │ • 规则配置    │          │
│  │ • 角色权限    │  │ • 日历标记    │  │ • 自动生成    │          │
│  │ • 部门管理    │  │ • 提交状态    │  │ • 手动调整    │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                 │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   换班管理    │  │   签到签退    │  │   通知提醒    │          │
│  ├──────────────┤  ├──────────────┤  ├──────────────┤          │
│  │ • 申请换班    │  │ • Web签到    │  │ • 邮件提醒    │          │
│  │ • 审批流程    │  │ • 签退记录    │  │ • 站内消息    │          │
│  │ • 换班记录    │  │ • 缺席处理    │  │ • 缺席通知    │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                 │
│  ┌──────────────┐                                              │
│  │   系统配置    │                                              │
│  ├──────────────┤                                              │
│  │ • 学期管理    │                                              │
│  │ • 时间段配置  │                                              │
│  │ • 规则开关    │                                              │
│  └──────────────┘                                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 核心功能详述

#### F1: 用户管理

| 功能ID | 功能名称 | 描述 | 优先级 |
|--------|----------|------|--------|
| F1.1 | 用户注册 | 仅支持管理员批量导入或邀请链接注册（不支持自助注册） | P0 |
| F1.2 | 用户登录 | 独立账号体系，学号+密码登录（支持记住我） | P0 |
| F1.3 | 角色分配 | 支持排班管理员、部门负责人、值班成员三种角色 | P0 |
| F1.4 | 部门管理 | 支持部门增删改，支持换届 | P0 |
| F1.5 | 人员名单管理 | 部门负责人勾选本部门值班人员 | P0 |

#### F2: 时间收集

| 功能ID | 功能名称 | 描述 | 优先级 |
|--------|----------|------|--------|
| F2.1 | OA账号课表导入 | V1不做，延期至V2 | P2 |
| F2.2 | ICS导入（文件/链接） | 上传ICS文件或填写ICS订阅链接导入课表 | P0 |
| F2.3 | 日历标记不可用时间 | 周视图/月视图拖拽选择+表单填写 | P0 |
| F2.4 | 提交状态查看 | 部门负责人查看本部门成员提交状态 | P0 |
| F2.5 | 全局提交进度 | 管理员查看所有部门提交进度 | P0 |

#### F3: 自动排班

| 功能ID | 功能名称 | 描述 | 优先级 |
|--------|----------|------|--------|
| F3.1 | 排班规则配置 | 配置硬约束规则，支持规则开关 | P0 |
| F3.2 | 自动排班执行 | 一键生成符合规则的排班表 | P0 |
| F3.3 | 人力不足提示 | 无法满足约束时提示管理员 | P0 |
| F3.4 | 手动调整 | 支持拖拽调整，实时规则检查 | P0 |
| F3.5 | 排班发布 | 发布排班表并通知所有成员 | P0 |

#### F4: 换班管理

| 功能ID | 功能名称 | 描述 | 优先级 |
|--------|----------|------|--------|
| F4.1 | 申请换班 | 成员选择目标班次和换班对象发起申请 | P0 |
| F4.2 | 换班同意 | 目标成员确认同意换班 | P0 |
| F4.3 | 管理员审核 | 管理员最终审批换班申请 | P0 |
| F4.4 | 换班截止时间 | 超过截止时间不允许申请换班 | P0 |
| F4.5 | 换班记录 | 记录所有换班历史 | P1 |

#### F5: 签到签退

| 功能ID | 功能名称 | 描述 | 优先级 |
|--------|----------|------|--------|
| F5.1 | Web点击签到 | 值班开始前15分钟可签到 | P0 |
| F5.2 | Web点击签退 | 值班结束后15分钟内需签退 | P0 |
| F5.3 | 迟到/缺席判定 | 迟到15分钟自动标记为缺席 | P0 |
| F5.4 | 缺席通知 | 缺席自动通知管理员 | P0 |
| F5.5 | 二维码签到 | 扫码签到（后期迭代） | P2 |

#### F6: 通知提醒

| 功能ID | 功能名称 | 描述 | 优先级 |
|--------|----------|------|--------|
| F6.1 | 值班提醒 | 值班前1天发送邮件提醒 | P0 |
| F6.2 | 排班发布通知 | 排班表发布后邮件通知 | P0 |
| F6.3 | 换班结果通知 | 换班审批结果邮件通知 | P0 |
| F6.4 | 缺席通知 | 缺席事件通知管理员 | P0 |

#### F7: 系统配置

| 功能ID | 功能名称 | 描述 | 优先级 |
|--------|----------|------|--------|
| F7.1 | 学期管理 | 配置学期开始/结束日期、单双周定义 | P0 |
| F7.2 | 时间段配置 | 配置每日值班时间段 | P0 |
| F7.3 | 规则开关 | 临时启用/禁用某些排班规则 | P0 |
| F7.4 | 换班截止时间配置 | 配置换班申请截止时间 | P0 |

---

## 四、业务规则

### 4.1 排班硬约束规则

| 规则ID | 规则名称 | 描述 | 可配置 |
|--------|----------|------|--------|
| R1 | 课表冲突 | 有课的时段绝对不能排班 | ❌ |
| R2 | 不可用时间冲突 | 用户标记的不可用时段不能排班 | ❌ |
| R6 | 同人同日不重复 | 同一成员同一天最多安排一个班次 | ❌ |
| R3 | 同日部门不重复 | 同一天的不同时段不能有来自同一部门的人 | ✅ |
| R4 | 相邻班次部门不重复 | 相邻两个时段不能来自同一部门 | ✅ |
| R5 | 单双周早八不重复 | 单周和双周的早八（8:10-10:05）不能是同一人 | ✅ |

### 4.2 排班优化目标（优先级从高到低）

| 优先级 | 目标 |
|--------|------|
| 1 | 满足所有硬约束规则 |
| 2 | 每人值班次数尽量均衡 |
| 3 | 上学期值过班的人优先级降低 |

### 4.3 签到规则

| 规则 | 描述 |
|------|------|
| 签到时间窗口 | 值班开始前15分钟 ~ 值班开始后15分钟 |
| 签退时间窗口 | 值班结束前15分钟 ~ 值班结束后15分钟 |
| 迟到判定 | 超过值班开始时间未签到 |
| 缺席判定 | 值班开始后15分钟仍未签到 |
| 缺席后补签 | 允许补签，需记录补签时间并通知管理员 |
| 未签退提醒 | 值班结束后15分钟仍未签退，提醒管理员 |

### 4.4 换班规则

| 规则 | 描述 |
|------|------|
| 审批流程 | 目标成员同意 → 管理员审核 |
| 截止时间 | 可配置（如值班前24小时） |
| 换班次数 | 不限制，由管理员判断 |
| 规则检查 | 换班必须校验目标成员与该班次的课表/不可用时间冲突；并校验目标成员当日无其他班次 |

---

## 五、非功能需求

### 5.1 性能需求

| 指标 | 要求 |
|------|------|
| 页面加载时间 | < 3秒 |
| 自动排班执行时间 | < 5分钟（150人规模） |
| 并发用户数 | 支持50人同时在线 |

### 5.2 安全需求

| 项目 | 要求 |
|------|------|
| 密码存储 | 不可逆加密存储（不得明文存储） |
| OA账号密码 | 仅用于课表拉取，不存储 |
| 角色权限 | 严格按角色控制功能访问 |

### 5.3 可用性需求

| 项目 | 要求 |
|------|------|
| 界面 | 简洁易用，支持日历拖拽操作 |
| 响应式 | 支持PC和移动端访问 |
| 浏览器兼容 | Chrome、Edge、Safari最新版 |

### 5.4 可扩展性

| 项目 | 要求 |
|------|------|
| 用户规模 | 支持扩展至500人 |
| 多地点值班 | 预留扩展能力 |
| 勤工/一站式社区 | 架构支持未来扩展 |

---

## 六、范围定义

### 6.1 范围内 (In Scope)

- ✅ 用户管理（邀请注册、登录、角色、部门）
- ✅ 课表导入（ICS上传，OA拉取V1延期）
- ✅ 日历式不可用时间标记
- ✅ 自动排班算法
- ✅ 手动调整（带规则检查）
- ✅ 换班流程（申请→同意→审核）
- ✅ 签到/签退（Web点击）
- ✅ 邮件通知（值班提醒、换班通知、缺席通知）
- ✅ 系统配置（学期、时间段、规则开关）

### 6.2 范围外 (Out of Scope)

- ❌ 微信小程序
- ❌ APP客户端
- ❌ OA课表导入（V1延期）
- ❌ 二维码签到（后期迭代）
- ❌ 定位签到
- ❌ 统计报表（暂不需要）
- ❌ 多地点值班管理
- ❌ 与学校其他系统对接（除课表API外）

---

## 七、风险、依赖与约束

### 7.1 依赖项

| 依赖 | 描述 | 状态 |
|------|------|------|
| 课表解析API | 已有项目提供JSON/ICS课表 | 待确认接口规范 |
| 邮件服务 | SMTP邮件发送 | 需配置 |
| 腾讯云服务器 | 部署环境 | 已有 |
| PostgreSQL | 数据库 | 已确定 |

### 7.2 风险

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 课表API不稳定 | 无法导入课表 | 提供ICS手动上传作为备选 |
| 排班算法无解 | 无法生成排班表 | 提示管理员调整规则或人员 |
| 用户不按时提交时间表 | 延误排班进度 | 部门负责人催促+系统提醒 |

### 7.3 约束

| 约束 | 描述 |
|------|------|
| 技术栈 | Web端，PostgreSQL数据库 |
| 部署环境 | 腾讯云服务器 |
| 用户规模 | 初期150-300人 |

---

## 八、开放问题

| 编号 | 问题 | 状态 |
|------|------|------|
| Q1 | 课表解析API的具体接口规范？ | 待确认 |
| Q2 | OA账号密码是否需要临时存储以便定期更新课表？ | 待确认 |
| Q3 | 换班截止时间的默认值是多少？ | 建议24小时 |
| Q4 | 邮件发送使用什么SMTP服务？ | 待确认 |
| Q5 | 用户注册是否需要审核？ | 已确认：仅支持邀请链接/批量导入注册 |

---

## 九、术语表

| 术语 | 定义 |
|------|------|
| 成员 | 参与值班的学生会成员（大一/大二新招） |
| 单双周 | 学期内按奇偶周区分的周期，排班按2周循环 |
| 硬约束 | 必须满足的排班规则，违反则排班无效 |
| 软约束 | 尽量满足的优化目标，可权衡取舍 |
| 时间表 | 成员的课表+其他不可用时间的集合 |

---

## 十、版本历史

| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|----------|--------|
| v1.0 | 2026-01-28 | 初稿 | - |
